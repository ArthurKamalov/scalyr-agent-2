Description:

# Syslog Monitor

The Syslog monitor can receive log messages received via the syslog protocol over either syslog  UDP or TCP/IP and
upload them to Scalyr.  This is useful for acting as a proxy between server applications that export their logs via
syslog and Scalyr.

The monitor accepts connections from the localhost (by default) and writes all received syslog messages to a single
log file (defaulting to ``agentSyslog.log``) which is then copied to Scalyr.  This log file is configured
to be parsed using the ``agentSyslog`` parser.  You may wish to edit this parser to parse the line according to your
specific syslog message format.

## Configuring Scalyr Agent

In order to use this monitor, you will first need to enable it in your agent's ``agent.json`` configuration file and
specify the protocol and ports to receive messages on.  A typical configuration fragment is shown below:

  monitors: [
    {
      module:              "scalyr_agent.builtin_monitors.syslog_monitor",
      protocols:            "tcp:601,udp:514"
    }
  ]

As the fragment demonstrates, you may listen on one or more protocol/port combinations using a comma-deliminated
list.  Only ``tcp`` or ``udp`` are allowed for the protocol specification, and any valid, unused port number is
allowed for the port.  Note, if you use ports 1024 or less on Linux, you must be sure your agent is running as root.

You may wish to accept syslog connections from other hosts than just localhost.  For example, you may have a
network device that cannot run the agent itself, but does use syslog to export its log.  You can configure
the Syslog Monitor to accept non-localhost connections by setting the ``accept_remote_connections`` configuration option
to true.  Here is a sample fragment that demonstrates this:

  monitors: [
    {
      module:                      "scalyr_agent.builtin_monitors.syslog_monitor",
      protocols:                   "tcp:601,udp:514",
      accept_remote_connections:   true
    }
  ]

See the options section below for more information about all of the available configuration options.

## Configuring syslog sources

After your agent is configured to accept syslog connections, you must then configure your log sources to send
messages to it.  If your application can send log messages directly, you will need to find instructions
on how to configure the syslog destination.  If you need help doing this, please feel free to e-mail
``contact@scalyr.com`` for help.

### Rsyslogd

Rsyslogd is a popular syslog server used on Linux machines.  It uses a very rich configuration language that allows
you to do complex operations with the syslog messages it receives, such as splitting them up into separate
log files by their log type or sending them to another syslog server over TCP/IP or UDP.

You may wish to configure rsyslogd to send a subset of the syslog messages generated by that server to
Scalyr.  There are many ways you can do this, but we will show you a simple example.

Suppose you wish to send all log messages with type ``authpriv`` to a the Syslog Monitor running on localhost over
TCP/IP using port 601. You would add the following lines to your rsyslogd configuration, which is typically stored
in ``/etc/rsyslogd.conf``:

  # Send all authpriv messasges to Scalyr.
  authpriv.*                                              @@localhost:601

You must ensure that the line appears in the file before any other filters that could match the authpriv messages.
Note, the ``@@`` prefix indicates TCP/IP should be used.  A single ``@`` indicates UDP.
    
Options:
|||# Option                       ||| Usage
|||# ``module``                   ||| Always ``scalyr_agent.builtin_monitors.syslog_monitor``
|||# ``protocols``                ||| Optional (defaults to tcp). Defines which transport protocols and ports to \
                                      listen for syslog messages on. Valid values can be 'udp' or 'tcp', which can be \
                                      bare, e.g. 'udp' or combined with a port number, e.g. 'udp:10514'.  Multiple \
                                      values can be combined with a comma to specify both, e.g. 'udp, tcp'.  If no \
                                      port is specified, then 514 is used for 'udp' and 601 is used for 'tcp'.
|||# ``accept_remote_connections``||| Optional (defaults to false). If true, the plugin will accept network \
                                      connections from any host, instead of just from localhost.
|||# ``message_log``              ||| Optional (defaults to agent_syslog.log). Defines a log file name for storing \
                                      syslog messages that are received by the agent syslog monitor. Note: the file \
                                      will be placed in the default Scalyr log directory unless it is an absolute \
                                      path.
|||# ``parser``                   ||| Optional (defaults to agentSyslog). Defines the parser that should be specified \
                                      for the message_log file.
|||# ``tcp_buffer_size``          ||| Optional (defaults to 8K).  The maximum buffer size for a single TCP syslog \
                                      message.  Note: RFC 5425 (syslog over TCP/TLS) says syslog receivers MUST be \
                                      able to support messages at least 2048 bytes long, and recommends they SHOULD \
                                      support messages up to 8192 bytes long.
|||# ``max_log_size``             ||| Optional (defaults to 100 MB - 100*1024*1024). The maximum file size of the \
                                      syslog messages log before log rotation occurs. Set to zero for infinite size.
|||# ``max_log_rotations``        ||| Optional (defaults to 5). The maximum number of log rotations before deleting \
                                      old logs. Set to zero for infinite rotations.

Log reference:
|||# Field||| Meaning

Metrics:

